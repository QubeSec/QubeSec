# QuantumDecapsulateSecret recovers a shared secret using KEM decapsulation.
# Takes a private key and ciphertext, and produces the same shared secret that was created
# during encapsulation. The ciphertext can come from an encapsulation operation.
apiVersion: qubesec.io/v1
kind: QuantumDecapsulateSecret
metadata:
  labels:
    app.kubernetes.io/name: quantumdecapsulatesecret
    app.kubernetes.io/instance: quantumdecapsulatesecret-sample
    app.kubernetes.io/part-of: qubesec
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/created-by: qubesec
  name: quantumdecapsulatesecret-sample
spec:
  # privateKeyRef: Reference to the QuantumKEMKeyPair that contains the private key
  privateKeyRef:
    name: quantumkemkeypair-sample
    namespace: default
  
  # ciphertext: Hex-encoded ciphertext from encapsulation (alternative: use ciphertextRef)
  ciphertext: ""
  
  # ciphertextRef: Reference to a QuantumEncapsulateSecret to get ciphertext from its status
  # If both ciphertext and ciphertextRef are set, ciphertext takes precedence
  ciphertextRef:
    name: quantumencapsulatesecret-sample
    namespace: default
  
  # algorithm: Must match the algorithm used in the referenced KeyPair
  algorithm: ML-KEM-1024
  
  # secretName: Kubernetes Secret where the recovered shared secret is stored
  # Output: Secret containing 'shared-secret' field (hex-encoded)
  # This secret should match the one created by QuantumEncapsulateSecret
  secretName: quantumdecapsulatesecret-sample-sharedsecret
